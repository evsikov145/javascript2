!function(e){var t={};function o(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(n,s,function(t){return e[t]}.bind(null,s));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";o.r(t);Vue.component("search",{props:{searchLine:{type:String,required:!1,default:""}},template:'\n        <form class="search-form" @submit.prevent>\n          <input type="text" class="search-input" :value="searchLine"\n            @input="updateSearchLine"/>\n        </form>\n    ',methods:{updateSearchLine(e){const t=e.target.value;this.$emit("update:searchLine",t)}}});const n=[];Vue.component("cart",{data:()=>({cart:n,isVisibleCart:!1}),methods:{toggleVisibility(){this.isVisibleCart=!this.isVisibleCart},deleteFromCart(e){this.cart.splice(e,1),this.cart=[...this.cart],this.$emit("delete",e)}},template:'\n    <div class="cart-container" v-if="isVisibleCart">\n      <ul>\n        <li v-for="(good, index) in cart">\n           {{good.product_name}}\n           <button @click="deleteFromCart(index)">X</button>\n        </li>\n      </ul>\n    </div>\n  '}),Vue.component("goods-item",{props:["good"],methods:{buy(){this.$emit("buy",this.good)}},template:'\n    <div class="goods-item">\n        <h3>{{ good.product_name }}</h3>\n        <p>{{ good.price }}</p>\n        <button @click="buy">Купить</button>\n    </div>\n  '}),Vue.component("goods-list",{props:["goods"],computed:{isGoodsEmpty(){return 0===this.goods.length}},methods:{buy(e){this.$emit("buy",e)}},template:'\n    <div class="goods-list" v-if="!isGoodsEmpty">\n      <goods-item v-for="good in goods" :good="good" :key="good.id_product" @buy=\'buy\'></goods-item>\n    </div>\n    <div class="not-found-items" v-else>\n      <h2>Нет данных</h2>\n    </div>\n  '});new Vue({el:"#app",data:{goods:[],searchLine:"",error:""},methods:{setError(e){this.error=e.message||e,setTimeout(()=>{this.error=""},3500)},makeGETRequest:e=>new Promise((t,o)=>{let n;n=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){const e=JSON.parse(n.responseText);t(e)}else o(n.responseText)},n.onerror=function(e){o(e)},n.open("GET",e),n.send()}),makeDELETERequest:e=>new Promise((t,o)=>{let n;n=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),n.onreadystatechange=function(){4===n.readyState&&(200===n.status?t(n.responseText):o(n.responseText))},n.onerror=function(e){o(e)},n.open("DELETE",e),n.send()}),makePOSTRequest:(e,t)=>new Promise((o,n)=>{let s;s=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),s.onreadystatechange=function(){4===s.readyState&&(200===s.status?o(s.responseText):n(s.responseText))},s.onerror=function(e){n(e)},s.open("POST",e),s.setRequestHeader("Content-Type","application/json; charset=UTF-8"),s.send(JSON.stringify(t))}),toggleCartVisibility(){this.$refs.cart.toggleVisibility()},async buy(e){await this.makePOSTRequest("/cart",e),n.push(e)},deleteFromCart(e){this.makeDELETERequest(`/cart/${e}`)}},computed:{isSearchActive(){return this.searchLine.length>0},filteredGoods(){const e=this.searchLine.replace(/[\*]/gi,""),t=new RegExp(e,"i");return this.goods.filter(e=>t.test(e.product_name))}},mounted(){Promise.all([this.makeGETRequest("/catalog"),this.makeGETRequest("/cart")]).then(([e,t])=>{this.goods=e,n.push(...t)}).catch(()=>{this.setError("Товары не найдены")})}})}]);