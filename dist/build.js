!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);Vue.component("search",{props:{searchLine:{type:String,required:!1,default:""}},template:'\n        <form class="search-form" @submit.prevent>\n          <input type="text" class="search-input" :value="searchLine"\n            @input="updateSearchLine"/>\n        </form>\n    ',methods:{updateSearchLine(e){const t=e.target.value;this.$emit("update:searchLine",t)}}}),Vue.component("cart",{data:()=>({isVisibleCart:!1}),props:{cart:Array},methods:{deleteFromCart(e){this.cart.splice(e,1),this.$emit("delete",e)}},template:'\n      <div class="cart-container">\n        <ul>\n          <li v-for="(good, index) in cart">\n             {{good.product_name}}\n             <button @click="deleteFromCart(index)">X</button>\n          </li>\n        </ul>\n      </div>\n    '}),Vue.component("goods-item",{props:["good"],methods:{buy(){this.$emit("buy",this.good)}},template:'\n      <div class="goods-item">\n          <h3>{{ good.product_name }}</h3>\n          <p>{{ good.price }}</p>\n          <button @click="buy">Купить</button>\n      </div>\n    '}),Vue.component("goods-list",{props:["goods"],computed:{isGoodsEmpty(){return 0===this.goods.length}},methods:{buy(e){this.$emit("buy",e)}},template:'\n      <div class="goods-list" v-if="!isGoodsEmpty">\n        <goods-item v-for="good in goods" :good="good" :key="good.id_product" @buy=\'buy\'></goods-item>\n      </div>\n      <div class="not-found-items" v-else>\n        <h2>Нет данных</h2>\n      </div>\n    '}),new Vue({el:"#app",data:{goods:[],searchLine:"",error:"",v_cart:!1,cart:[]},template:'\n    <div>\n      <transition name="fade">\n        <div class="notification error" v-if="error && error.length">\n          {{ error }}\n        </div>\n      </transition>\n      <header class="header">\n        <div class="container">\n          <search :search-line.sync="searchLine"></search>\n          <button class="cart-button" @click="toggleCartVisibility">Корзина</button>\n          <cart v-if="v_cart" @delete = \'deleteFromCart\' :cart="cart"></cart>\n        </div>\n      </header>\n      <main :class="{[\'search-active\']: searchLine.length > 0}">\n        <goods-list :goods="filteredGoods" @buy=\'buy\'></goods-list>\n      </main>\n    </div>\n  ',methods:{setError(e){this.error=e.message||e,setTimeout(()=>{this.error=""},3500)},makeGETRequest:e=>new Promise((t,n)=>{let o;o=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status){const e=JSON.parse(o.responseText);t(e)}else n(o.responseText)},o.onerror=function(e){n(e)},o.open("GET","http://localhost:3000"+e),o.send()}),makeDELETERequest:e=>new Promise((t,n)=>{let o;o=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),o.onreadystatechange=function(){4===o.readyState&&(200===o.status?t(o.responseText):n(o.responseText))},o.onerror=function(e){n(e)},o.open("DELETE","http://localhost:3000"+e),o.send()}),makePOSTRequest:(e,t)=>new Promise((n,o)=>{let r;r=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),r.onreadystatechange=function(){4===r.readyState&&(200===r.status?n(r.responseText):o(r.responseText))},r.onerror=function(e){o(e)},r.open("POST","http://localhost:3000"+e),r.setRequestHeader("Content-Type","application/json; charset=UTF-8"),r.send(JSON.stringify(t))}),toggleCartVisibility(){this.v_cart=!this.v_cart},async buy(e){let t=await this.makePOSTRequest("/cart",e);t=JSON.parse(t),console.log(t),this.cart=t},async deleteFromCart(e){const t=await this.makeDELETERequest(`/cart/${e}`);this.cart=JSON.parse(t)}},beforeMount(){this.makeGETRequest("/cart").then(e=>{this.cart=e})},computed:{isSearchActive(){return this.searchLine.length>0},filteredGoods(){const e=this.searchLine.replace(/[\*]/gi,""),t=new RegExp(e,"i");return this.goods.filter(e=>t.test(e.product_name))}},mounted(){Promise.all([this.makeGETRequest("/catalog"),this.makeGETRequest("/cart")]).then(([e,t])=>{this.goods=e,cart.push(...t)}).catch(()=>{this.setError("Товары не найдены")})}})}]);